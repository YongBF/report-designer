# 🤖 自动化测试使用指南

## ✅ 测试结果

**最新测试运行（刚刚完成）**：
```
总测试数: 10
通过: 10 ✅
失败: 0 ✅
通过率: 100.0%
```

所有API接口测试全部通过！🎉

## 🚀 快速开始

### 一键运行自动化测试

```bash
cd mock-server
npm run test:auto
```

测试会自动：
1. ✅ 检查Mock Server是否启动
2. 🧪 测试所有10个API接口
3. 📊 生成详细的HTML测试报告
4. 🌐 自动在浏览器中打开报告

## 📋 测试覆盖范围

### 1. 用户列表接口 (GET)
- **路径**: `/api/users`
- **测试内容**: 表格数据返回
- **响应时间**: ~500ms
- **数据大小**: 539 bytes

### 2. 订单列表接口 (POST)
- **路径**: `/api/orders`
- **测试内容**: POST请求 + 参数传递
- **参数回显**: ✅ 验证接收到的参数
- **响应时间**: ~800ms

### 3. 销售数据接口 (POST)
- **路径**: `/api/sales`
- **测试内容**: 图表数据 + 参数回显
- **参数**: startDate, endDate
- **响应时间**: ~600ms

### 4. 用户分布接口 (GET)
- **路径**: `/api/user-distribution`
- **测试内容**: 饼图数据格式
- **响应时间**: ~400ms

### 5. CPU使用率接口 (GET)
- **路径**: `/api/cpu`
- **测试内容**: 仪表盘数据格式
- **响应时间**: ~300ms

### 6. 月度趋势接口 (GET)
- **路径**: `/api/trends`
- **测试内容**: 多系列图表数据
- **响应时间**: ~500ms

### 7. 产品销售接口 (POST)
- **路径**: `/api/product-sales`
- **测试内容**: 饼图 + 参数传递
- **参数回显**: ✅
- **响应时间**: ~500ms

### 8. 内存使用率接口 (GET)
- **路径**: `/api/memory`
- **测试内容**: 仪表盘数据
- **响应时间**: ~300ms

### 9. 身高体重接口 (GET)
- **路径**: `/api/height-weight`
- **测试内容**: 散点图数据
- **响应时间**: ~500ms

### 10. 转化漏斗接口 (GET)
- **路径**: `/api/funnel`
- **测试内容**: 漏斗图数据
- **响应时间**: ~400ms

## 📄 测试报告

测试报告会自动生成在：
```
mock-server/test-reports/report.html
```

### 报告内容包括：
- 📊 测试总结（总数、通过、失败、通过率）
- ⏱ 总耗时和总数据量统计
- 📋 每个测试的详细信息：
  - 测试名称和描述
  - 请求方法和路径
  - 响应时间
  - 数据大小
  - 参数回显验证
  - 响应数据预览
- 🎨 美观的可视化界面
- 🔄 一键重新测试按钮

### 报告界面特点：
- 渐变色卡片设计
- 响应式布局
- 悬停动画效果
- JSON数据格式化显示
- 自动刷新功能

## 🎯 测试验证项

每个测试都会验证：
1. ✅ **HTTP状态码**: 必须是200
2. ✅ **数据格式**: JSON正确解析
3. ✅ **success字段**: 必须为true
4. ✅ **data字段**: 必须存在
5. ✅ **参数回显**: POST请求验证参数是否正确返回

## 🔧 测试脚本位置

- **主测试脚本**: `src/auto-test.js`
- **E2E测试脚本**: `src/e2e-test.js`（需要Puppeteer）
- **基础测试**: `src/test.js`

## 💡 使用技巧

### 1. 在开发过程中持续测试
```bash
# 启动Mock Server（开发模式）
npm run dev

# 在另一个终端运行测试
npm run test:auto
```

### 2. 测试特定接口
修改 `src/auto-test.js` 中的 `testCases` 数组，注释掉不需要的测试。

### 3. 自定义测试数据
```javascript
{
  name: '自定义接口',
  method: 'POST',
  path: '/api/custom',
  body: { your: 'params' },
  description: '测试自定义接口'
}
```

### 4. 查看详细日志
在测试报告中点击"响应数据"展开查看完整的JSON响应。

## 📊 性能基准

根据最新的测试结果：

| 接口类型 | 平均响应时间 |
|---------|-------------|
| GET请求 | ~400ms |
| POST请求 | ~600ms |
| 最快接口 | CPU/内存 (~300ms) |
| 最慢接口 | 订单列表 (~800ms) |

## 🎨 测试报告示例

打开报告后你会看到：

```
┌─────────────────────────────────────┐
│     🚀 Mock Server 测试报告        │
│                                     │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐      │
│  │ 10 │ │ 10 │ │  0 │ │100%│      │
│  │总数│ │通过│ │失败│ │通过│      │
│  └────┘ └────┘ └────┘ └────┘      │
│                                     │
│  📋 测试详情                        │
│  ┌──────────────────────────────┐  │
│  │ ✅ 用户列表接口               │  │
│  │ GET /api/users               │  │
│  │ ⏱ 506ms  📦 539 bytes       │  │
│  │ 💬 成功，响应时间 506ms      │  │
│  └──────────────────────────────┘  │
│  ... 更多测试结果 ...              │
└─────────────────────────────────────┘
```

## 🔄 CI/CD 集成

可以将测试集成到CI/CD流程中：

```yaml
# GitHub Actions 示例
- name: Start Mock Server
  run: |
    cd mock-server
    npm start &
    sleep 5

- name: Run Tests
  run: |
    cd mock-server
    npm run test:auto

- name: Upload Report
  uses: actions/upload-artifact@v2
  with:
    name: test-report
    path: mock-server/test-reports/report.html
```

## 📝 测试报告历史

每次运行测试都会覆盖之前的报告。如需保存历史记录：

```bash
# 在运行测试前备份
cp test-reports/report.html test-reports/report-$(date +%Y%m%d-%H%M%S).html

# 然后运行测试
npm run test:auto
```

## ⚠️ 故障排查

### 问题1: "Mock Server未启动"
**解决**:
```bash
cd mock-server
npm start
```

### 问题2: "端口被占用"
**解决**:
```bash
# Mac/Linux
lsof -ti:3001 | xargs kill -9

# 然后重启服务器
npm start
```

### 问题3: "测试失败率100%"
**检查**:
1. 查看控制台日志
2. 确认所有接口是否正常注册
3. 检查数据文件是否存在

## 🎓 学习资源

- 查看测试报告了解每个接口的响应格式
- 查看响应数据了解数据结构
- 使用参数回显功能调试联动功能

## 🚀 下一步

1. ✅ 自动化测试已完成
2. ✅ 所有接口测试通过（100%）
3. ✅ 测试报告已在浏览器中打开
4. 📝 可以开始使用Mock Server进行前端开发

---

**现在你可以放心地使用Mock Server进行Report Designer的开发和测试了！** 🎉
